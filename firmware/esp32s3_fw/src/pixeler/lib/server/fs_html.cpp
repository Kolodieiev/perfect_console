#include <stdint.h>

const char HEAD_HTML[] = R"rawliteral(<!DOCTYPE html><html lang="uk"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>)rawliteral";

const char MID_HTML[] = "</title></head><body>";
const char FOOT_HTML[] = "</body></html>";

const char RECEIVE_TITLE_STR[] = "Надіслати файл";
const char SEND_TITLE_STR[] = "Список файлів";

const char NOT_FOUND_TITLE_STR[] = "404";
const char NOT_FOUND_BODY_START[] = "<h1>Файл не знайдено</h1><a href=\"";
const char NOT_FOUND_BODY_END[] = "\">На головну</a>";

const char RECEIVE_FILE_HTML[] = R"rawliteral(
</title><style>body{font-family:Arial,sans-serif;display:flex;flex-direction:column;align-items:center;padding:20px;margin:0;}h1{color:#333;text-align:center;}.form-container{display:flex;flex-direction:column;align-items:center;border:2px dashed #ccc;padding:20px;margin-top:20px;width:95%;max-width:500px;text-align:center;box-sizing:border-box;}.form-container.dragover{background-color:#f0f0f0;border-color:#4caf50;}.form-container input[type="file"]{margin-bottom:20px;width:100%;box-sizing:border-box;}.form-container form{display:flex;flex-direction:column;align-items:center;width:100%;}.button-container{display:flex;justify-content:center;width:100%;gap:10px;flex-wrap:wrap;}.form-container button{background-color:#66bb6a;color:white;border:none;padding:12px 24px;font-size:16px;border-radius:5px;cursor:pointer;transition:background-color 0.3s;margin-top:10px;}.form-container button:hover{background-color:#57a05a;}.form-container button.cancel{background-color:#f44336;display:none;}.form-container button.clear{background-color:#ff9800;}.progress-bar{width:100%;height:20px;background-color:#e0e0e0;border-radius:5px;margin-top:10px;overflow:hidden;}.progress{height:100%;width:0%;background-color:#4caf50;border-radius:5px;transition:width 0.2s;}.file-name{margin-top:10px;font-size:14px;color:#555;word-break:break-all;}.upload-counter{margin-top:5px;font-size:14px;color:#333;font-weight:bold;}.upload-speed{font-size:12px;color:#888;margin-top:5px;height:15px;}.file-list-container{width:100%;max-height:250px;overflow-y:auto;margin-top:15px;border:1px solid #e0e0e0;border-radius:5px;background-color:#fafafa;display:none;}.file-item{display:flex;align-items:center;padding:10px;border-bottom:1px solid #e0e0e0;gap:10px;}.status-indicator{width:12px;height:12px;border-radius:50%;flex-shrink:0;}.status-pending{background-color:#9e9e9e;}.status-uploading{background-color:#ffc107;}.status-success{background-color:#4caf50;}.status-error{background-color:#f44336;}.file-item-name{flex-grow:1;text-align:left;font-size:14px;color:#333;word-break:break-all;}.remove-file{color:#f44336;cursor:pointer;font-weight:bold;padding:0 5px;font-size:18px;user-select:none;}</style></head><body><h1>Надіслати файл</h1><div class="form-container" id="dropArea"><p>Перетягніть файли сюди або виберіть</p><form id="uploadForm"><input type="file" id="fileInput" multiple required><div class="button-container"><button type="submit" id="submitBtn">Надіслати</button><button type="button" id="cancelBtn" class="cancel">Скасувати</button><button type="button" id="clearBtn" class="clear" style="display:none;">Очистити список</button></div></form><div class="file-name" id="fileName"></div><div class="upload-counter" id="uploadCounter" style="display:none;"></div><div class="progress-bar" id="progressBar" style="display:none;"><div class="progress" id="progress"></div></div><div class="upload-speed" id="uploadSpeed"></div><div class="file-list-container" id="fileListContainer"></div></div><script>const uploadForm=document.getElementById('uploadForm'),fileInput=document.getElementById('fileInput'),dropArea=document.getElementById('dropArea'),fileName=document.getElementById('fileName'),submitBtn=document.getElementById('submitBtn'),cancelBtn=document.getElementById('cancelBtn'),clearBtn=document.getElementById('clearBtn'),fileListContainer=document.getElementById('fileListContainer'),uploadCounter=document.getElementById('uploadCounter'),prog=document.getElementById('progress'),progBar=document.getElementById('progressBar'),upSpd=document.getElementById('uploadSpeed');let currentXhr=null,fileQueue=[],currentFileIndex=0,successCount=0,startTime=0,lastProgressTime=0,watchdog=null;function resetUploadState(){prog.style.width='0%';progBar.style.display='none';upSpd.textContent='';submitBtn.style.display='block';cancelBtn.style.display='none';clearBtn.style.display=fileQueue.length>0?'block':'none';currentXhr=null;clearInterval(watchdog);renderFileList()}function updateCounter(){if(fileQueue.length>0){uploadCounter.textContent=`Успішно: ${successCount}/${fileQueue.length}`;uploadCounter.style.display='block';fileName.textContent=fileQueue.length+' файл(ів) обрано'}else{uploadCounter.style.display='none';fileName.textContent=''}}function addFilesToQueue(files){fileQueue=[];successCount=0;for(let i=0;i<files.length;i++)fileQueue.push({file:files[i],status:'pending'});renderFileList();clearBtn.style.display='block';updateCounter()}function removeFile(idx){if(currentXhr)return;fileQueue.splice(idx,1);const dt=new DataTransfer();fileQueue.forEach(f=>dt.items.add(f.file));fileInput.files=dt.files;if(fileQueue.length===0)clearBtn.style.display='none';updateCounter();renderFileList()}function renderFileList(){if(!fileQueue.length){fileListContainer.style.display='none';return}fileListContainer.style.display='block';fileListContainer.innerHTML='';fileQueue.forEach((item,idx)=>{const i=document.createElement('div'),s=document.createElement('div'),n=document.createElement('div'),r=document.createElement('div');i.className='file-item';s.className='status-indicator status-'+item.status;n.className='file-item-name';n.textContent=item.file.name;i.appendChild(s);i.appendChild(n);if(!currentXhr){r.className='remove-file';r.innerHTML='&times;';r.onclick=()=>removeFile(idx);i.appendChild(r)}fileListContainer.appendChild(i)})}function uploadNextFile(){if(currentFileIndex>=fileQueue.length){resetUploadState();updateCounter();alert('Завантаження завершено!');return}const item=fileQueue[currentFileIndex];item.status='uploading';renderFileList();uploadFile(item.file)}uploadForm.addEventListener('submit',e=>{e.preventDefault();if(!fileQueue.length)return alert('Виберіть файли');fileQueue.forEach(f=>f.status='pending');currentFileIndex=0;successCount=0;uploadNextFile()});cancelBtn.addEventListener('click',()=>{if(currentXhr){currentXhr.abort();fileQueue.forEach(f=>{if(f.status==='uploading')f.status='pending'});resetUploadState()}});clearBtn.addEventListener('click',()=>{fileQueue=[];currentFileIndex=0;successCount=0;fileInput.value='';fileName.textContent='';uploadCounter.style.display='none';clearBtn.style.display='none';renderFileList();resetUploadState()});function uploadFile(file){prog.style.width='0%';const d=new FormData();d.append('file',file);currentXhr=new XMLHttpRequest();currentXhr.open('POST','/upload');lastProgressTime=Date.now();watchdog=setInterval(()=>{if(Date.now()-lastProgressTime>20000){currentXhr.abort();fileQueue[currentFileIndex].status='error';renderFileList();currentFileIndex++;updateCounter();uploadNextFile()}},1000);currentXhr.upload.addEventListener('progress',e=>{if(e.lengthComputable){lastProgressTime=Date.now();prog.style.width=(e.loaded/e.total)*100+'%';let dur=(Date.now()-startTime)/1000;if(dur>0){let bps=e.loaded/dur,rem=e.total-e.loaded,eta=Math.round(rem/bps);upSpd.textContent=(bps>1048576?(bps/1048576).toFixed(1)+' MB/s':(bps/1024).toFixed(1)+' KB/s')+` (~${eta}с)`}}});currentXhr.addEventListener('loadstart',()=>{progBar.style.display='block';submitBtn.style.display='none';cancelBtn.style.display='block';clearBtn.style.display='none';startTime=Date.now();renderFileList()});currentXhr.addEventListener('load',()=>{clearInterval(watchdog);if(currentXhr.status===200){fileQueue[currentFileIndex].status='success';successCount++}else{fileQueue[currentFileIndex].status='error'}currentFileIndex++;updateCounter();uploadNextFile()});currentXhr.addEventListener('error',()=>{clearInterval(watchdog);fileQueue[currentFileIndex].status='error';currentFileIndex++;updateCounter();uploadNextFile()});currentXhr.send(d)}dropArea.addEventListener('dragover',e=>{e.preventDefault();dropArea.classList.add('dragover')});dropArea.addEventListener('dragleave',()=>dropArea.classList.remove('dragover'));dropArea.addEventListener('drop',e=>{e.preventDefault();dropArea.classList.remove('dragover');if(e.dataTransfer.files.length){fileInput.files=e.dataTransfer.files;addFilesToQueue(e.dataTransfer.files)}});fileInput.addEventListener('change',()=>{if(fileInput.files.length){addFilesToQueue(fileInput.files)}});</script></body></html>
)rawliteral";

const char HREF_HTML[] = "<br><br><a href=\"/?filename=";